<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxy Conquest - –ö–æ—Å–º–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a0a2a 0%, #1a1a40 100%);
            color: #e0e0ff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 20px;
            background: rgba(10, 20, 40, 0.8);
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid #2a5c8c;
            box-shadow: 0 0 20px rgba(42, 92, 140, 0.5);
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4dabf7, #da77f2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 15px rgba(77, 171, 247, 0.3);
        }

        .game-phase {
            font-size: 1.3rem;
            color: #8ce99a;
            margin: 10px 0;
        }

        .game-setup {
            background: rgba(20, 30, 60, 0.9);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 1px solid #364fc7;
        }

        .setup-options {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 15px;
        }

        .option {
            background: rgba(30, 40, 80, 0.8);
            padding: 15px;
            border-radius: 10px;
            min-width: 200px;
        }

        .option h3 {
            color: #74c0fc;
            margin-bottom: 10px;
        }

        select, input, button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border: 1px solid #4dabf7;
            background: rgba(10, 20, 40, 0.8);
            color: white;
            font-size: 1rem;
        }

        button {
            background: linear-gradient(90deg, #228be6, #3bc9db);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(34, 139, 230, 0.4);
        }

        button:disabled {
            background: #495057;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .game-board {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-top: 25px;
        }

        @media (max-width: 1024px) {
            .game-board {
                grid-template-columns: 1fr;
            }
        }

        .galaxy-map {
            background: rgba(10, 15, 35, 0.95);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #5c7cfa;
            min-height: 600px;
            position: relative;
            overflow: hidden;
        }

        .systems-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .system {
            background: rgba(30, 40, 80, 0.8);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .system:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(92, 124, 250, 0.3);
        }

        .system.owned {
            border-color: currentColor;
        }

        .system-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .system-resources {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #adb5bd;
            margin-top: 10px;
        }

        .player-info {
            background: rgba(20, 30, 60, 0.9);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #ffa94d;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .player-card {
            background: rgba(30, 40, 80, 0.8);
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid;
        }

        .player-card.active {
            box-shadow: 0 0 25px rgba(255, 169, 77, 0.4);
            transform: scale(1.02);
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .player-name {
            font-size: 1.4rem;
            font-weight: bold;
        }

        .player-resources {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }

        .resource {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .actions-panel {
            background: rgba(20, 30, 60, 0.9);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #51cf66;
            margin-top: 25px;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .action-btn {
            background: linear-gradient(90deg, #51cf66, #69db7c);
            padding: 18px;
            font-size: 1.1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .action-btn.build {
            background: linear-gradient(90deg, #ffa94d, #ffc078);
        }

        .action-btn.attack {
            background: linear-gradient(90deg, #ff6b6b, #ff8787);
        }

        .action-btn.research {
            background: linear-gradient(90deg, #da77f2, #e599f7);
        }

        .log {
            background: rgba(10, 15, 35, 0.95);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #868e96;
            margin-top: 25px;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-title {
            color: #adb5bd;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .log-entry {
            padding: 10px;
            margin: 8px 0;
            background: rgba(30, 40, 80, 0.5);
            border-radius: 8px;
            border-left: 4px solid;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .player-1 { color: #4dabf7; border-color: #4dabf7; }
        .player-2 { color: #ff6b6b; border-color: #ff6b6b; }
        .player-3 { color: #51cf66; border-color: #51cf66; }

        .system.owned.player-1 { background: rgba(77, 171, 247, 0.15); }
        .system.owned.player-2 { background: rgba(255, 107, 107, 0.15); }
        .system.owned.player-3 { background: rgba(81, 207, 102, 0.15); }

        .fleet {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            padding: 3px 8px;
            border-radius: 12px;
            margin: 2px;
            font-size: 0.8rem;
        }

        .victory-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
            gap: 30px;
            text-align: center;
        }

        .victory-content {
            background: linear-gradient(135deg, #1a1a40, #0a0a2a);
            padding: 50px;
            border-radius: 20px;
            border: 3px solid gold;
            max-width: 600px;
            width: 90%;
        }

        .victory-title {
            font-size: 3.5rem;
            color: gold;
            margin-bottom: 20px;
            text-shadow: 0 0 20px gold;
        }

        .winner-name {
            font-size: 2.5rem;
            margin: 20px 0;
            color: #4dabf7;
        }

        .online-setup {
            background: rgba(40, 50, 90, 0.9);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            display: none;
        }

        .online-setup.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        .connection-status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }

        .connected { background: rgba(81, 207, 102, 0.2); color: #51cf66; }
        .disconnected { background: rgba(255, 107, 107, 0.2); color: #ff6b6b; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-globe-americas"></i> Galaxy Conquest</h1>
            <p>–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞ –¥–ª—è 2-3 –∏–≥—Ä–æ–∫–æ–≤. –ó–∞–≤–æ—é–π—Ç–µ –≥–∞–ª–∞–∫—Ç–∏–∫—É!</p>
            <div class="game-phase" id="gamePhase">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–≥—Ä—ã</div>
        </header>

        <div class="game-setup" id="gameSetup">
            <h2><i class="fas fa-cogs"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–≥—Ä—ã</h2>
            <div class="setup-options">
                <div class="option">
                    <h3><i class="fas fa-users"></i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤</h3>
                    <select id="playerCount">
                        <option value="2">2 –∏–≥—Ä–æ–∫–∞</option>
                        <option value="3">3 –∏–≥—Ä–æ–∫–∞</option>
                    </select>
                </div>
                <div class="option">
                    <h3><i class="fas fa-map"></i> –†–∞–∑–º–µ—Ä –≥–∞–ª–∞–∫—Ç–∏–∫–∏</h3>
                    <select id="galaxySize">
                        <option value="12">–ú–∞–ª–µ–Ω—å–∫–∞—è (12 —Å–∏—Å—Ç–µ–º)</option>
                        <option value="18" selected>–°—Ä–µ–¥–Ω—è—è (18 —Å–∏—Å—Ç–µ–º)</option>
                        <option value="24">–ë–æ–ª—å—à–∞—è (24 —Å–∏—Å—Ç–µ–º—ã)</option>
                    </select>
                </div>
                <div class="option">
                    <h3><i class="fas fa-wifi"></i> –†–µ–∂–∏–º –∏–≥—Ä—ã</h3>
                    <select id="gameMode">
                        <option value="local">–ù–∞ –æ–¥–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</option>
                        <option value="online">–û–Ω–ª–∞–π–Ω (–ø–æ –æ—á–µ—Ä–µ–¥–∏)</option>
                    </select>
                </div>
            </div>

            <div class="online-setup" id="onlineSetup">
                <h3><i class="fas fa-network-wired"></i> –û–Ω–ª–∞–π–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                <input type="text" id="roomCode" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –Ω–æ–≤–æ–π)">
                <button onclick="joinOnlineRoom()"><i class="fas fa-sign-in-alt"></i> –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ</button>
                <div class="connection-status disconnected" id="connectionStatus">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</div>
                <div id="onlinePlayers">–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...</div>
            </div>

            <button onclick="startGame()" id="startBtn" style="margin-top: 20px;">
                <i class="fas fa-rocket"></i> –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
            </button>
        </div>

        <div class="game-board" id="gameBoard" style="display: none;">
            <div class="galaxy-map">
                <h2><i class="fas fa-star"></i> –ö–∞—Ä—Ç–∞ –≥–∞–ª–∞–∫—Ç–∏–∫–∏</h2>
                <div class="systems-grid" id="systemsGrid"></div>
            </div>
            
            <div class="player-info">
                <h2><i class="fas fa-user-astronaut"></i> –ò–≥—Ä–æ–∫–∏</h2>
                <div id="playersContainer"></div>
            </div>
        </div>

        <div class="actions-panel" id="actionsPanel" style="display: none;">
            <h2><i class="fas fa-tools"></i> –î–µ–π—Å—Ç–≤–∏—è</h2>
            <p id="currentPlayerTurn">–•–æ–¥ –∏–≥—Ä–æ–∫–∞ 1</p>
            <div class="action-buttons">
                <button class="action-btn build" onclick="performAction('build')">
                    <i class="fas fa-hard-hat"></i>
                    <span>–ü–æ—Å—Ç—Ä–æ–∏—Ç—å —Ñ–ª–æ—Ç</span>
                    <small>+2 –∫–æ—Ä–∞–±–ª—è –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ</small>
                </button>
                <button class="action-btn attack" onclick="performAction('attack')">
                    <i class="fas fa-fighter-jet"></i>
                    <span>–ê—Ç–∞–∫–æ–≤–∞—Ç—å</span>
                    <small>–ó–∞—Ö–≤–∞—Ç–∏—Ç—å —Å–æ—Å–µ–¥–Ω—é—é —Å–∏—Å—Ç–µ–º—É</small>
                </button>
                <button class="action-btn research" onclick="performAction('research')">
                    <i class="fas fa-flask"></i>
                    <span>–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å</span>
                    <small>+5 —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π</small>
                </button>
                <button class="action-btn" onclick="endTurn()">
                    <i class="fas fa-forward"></i>
                    <span>–ó–∞–∫–æ–Ω—á–∏—Ç—å —Ö–æ–¥</span>
                </button>
            </div>
        </div>

        <div class="log" id="gameLog">
            <div class="log-title">
                <span><i class="fas fa-scroll"></i> –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π</span>
                <button onclick="clearLog()" style="width: auto; padding: 5px 15px;">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div id="logEntries">
                <div class="log-entry player-1">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Galaxy Conquest!</div>
            </div>
        </div>
    </div>

    <div class="victory-screen" id="victoryScreen" style="display: none;">
        <div class="victory-content">
            <div class="victory-title">–ü–û–ë–ï–î–ê!</div>
            <div class="winner-name" id="winnerName"></div>
            <p id="victoryText"></p>
            <button onclick="resetGame()" style="margin-top: 30px; padding: 15px 40px;">
                <i class="fas fa-redo"></i> –ù–æ–≤–∞—è –∏–≥—Ä–∞
            </button>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω)
        const firebaseConfig = {
            apiKey: "AIzaSyC0t7l5w7X6q8Y3q1wK4pKz4x4Xq4x4Xq4",
            authDomain: "galaxy-conquest-game.firebaseapp.com",
            databaseURL: "https://galaxy-conquest-game-default-rtdb.firebaseio.com",
            projectId: "galaxy-conquest-game",
            storageBucket: "galaxy-conquest-game.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        let gameState = {
            players: [],
            systems: [],
            currentPlayer: 0,
            round: 1,
            selectedSystem: null,
            gameMode: 'local',
            onlineRoom: null
        };

        // –¶–≤–µ—Ç–∞ –∏ –∏–º–µ–Ω–∞ –∏–≥—Ä–æ–∫–æ–≤
        const playerConfigs = [
            { id: 1, name: "–°–∏–Ω—è—è –§–µ–¥–µ—Ä–∞—Ü–∏—è", color: "#4dabf7", icon: "üöÄ" },
            { id: 2, name: "–ö—Ä–∞—Å–Ω—ã–π –ê–ª—å—è–Ω—Å", color: "#ff6b6b", icon: "‚öîÔ∏è" },
            { id: 3, name: "–ó–µ–ª–µ–Ω–∞—è –ò–º–ø–µ—Ä–∏—è", color: "#51cf66", icon: "üëë" }
        ];

        // –ù–∞–∑–≤–∞–Ω–∏—è –∑–≤–µ–∑–¥–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
        const systemNames = [
            "–ê–ª—å—Ñ–∞ –¶–µ–Ω—Ç–∞–≤—Ä–∞", "–°–∏—Ä–∏—É—Å", "–ë–µ—Ç–µ–ª—å–≥–µ–π–∑–µ", "–í–µ–≥–∞", "–ê–Ω—Ç–∞—Ä–µ—Å",
            "–ê—Ä–∫—Ç—É—Ä", "–ü–æ–ª—è—Ä–Ω–∞—è", "–ê–ª—å–¥–µ–±–∞—Ä–∞–Ω", "–†–∏–≥–µ–ª—å", "–ö–∞–ø–µ–ª–ª–∞",
            "–ü—Ä–æ—Ü–∏–æ–Ω", "–ê–ª—å—Ç–∞–∏—Ä", "–§–æ–º–∞–ª—å–≥–∞—É—Ç", "–î–µ–Ω–µ–±", "–†–µ–≥—É–ª",
            "–ú–∏—Ü–∞—Ä", "–°–ø–∏–∫–∞", "–ü–æ–ª–ª—É–∫—Å", "–ê—Ö–µ—Ä–Ω–∞—Ä", "–ë–µ–ª–ª–∞—Ç—Ä–∏–∫—Å",
            "–ö–∞–Ω–æ–ø—É—Å", "–ê–ª—å–Ω–∞–∏—Ä", "–ú–∏—Ä–∞—Ö", "–ê–ª—å–≥–µ–Ω–∏–±", "–ê–ª—å–Ω–∏—Ç–∞–∫"
        ];

        function initGame() {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            const galaxySize = parseInt(document.getElementById('galaxySize').value);
            gameState.gameMode = document.getElementById('gameMode').value;

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–Ω–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞
            if (gameState.gameMode === 'online') {
                document.getElementById('onlineSetup').classList.add('active');
                document.getElementById('startBtn').disabled = true;
                initFirebase();
            } else {
                document.getElementById('onlineSetup').classList.remove('active');
                document.getElementById('startBtn').disabled = false;
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä–æ–∫–æ–≤
            gameState.players = [];
            for (let i = 0; i < playerCount; i++) {
                gameState.players.push({
                    id: i + 1,
                    name: playerConfigs[i].name,
                    color: playerConfigs[i].color,
                    icon: playerConfigs[i].icon,
                    resources: {
                        credits: 50,
                        fleet: 10,
                        tech: 0
                    },
                    systems: []
                });
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤–µ–∑–¥–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
            gameState.systems = [];
            const availableNames = [...systemNames].sort(() => Math.random() - 0.5);
            
            for (let i = 0; i < galaxySize; i++) {
                const resources = {
                    credits: Math.floor(Math.random() * 5) + 1,
                    fleet: Math.floor(Math.random() * 3),
                    tech: Math.floor(Math.random() * 2)
                };

                // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏
                let owner = null;
                if (i < playerCount) {
                    owner = i + 1;
                    gameState.players[i].systems.push(i);
                }

                gameState.systems.push({
                    id: i,
                    name: availableNames[i % availableNames.length],
                    owner: owner,
                    resources: resources,
                    position: { x: (i % 6) * 150 + 50, y: Math.floor(i / 6) * 150 + 50 },
                    connections: generateConnections(i, galaxySize)
                });
            }

            gameState.currentPlayer = 0;
            gameState.round = 1;
            updateGamePhase();
        }

        function generateConnections(systemId, totalSystems) {
            const connections = [];
            // –°–æ–∑–¥–∞–µ–º —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Å–æ—Å–µ–¥–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ç–∫–∏
            const row = Math.floor(systemId / 6);
            const col = systemId % 6;
            
            // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏
            if (col < 5 && systemId + 1 < totalSystems) connections.push(systemId + 1);
            if (col > 0) connections.push(systemId - 1);
            
            // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Å–∏—Å—Ç–µ–º–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ä—è–¥—É)
            if (row < Math.floor((totalSystems - 1) / 6)) {
                const nextRowId = systemId + 6;
                if (nextRowId < totalSystems) connections.push(nextRowId);
            }
            
            return connections;
        }

        function startGame() {
            if (gameState.gameMode === 'online' && !gameState.onlineRoom) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –∫ –∫–æ–º–Ω–∞—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é');
                return;
            }

            document.getElementById('gameSetup').style.display = 'none';
            document.getElementById('gameBoard').style.display = 'grid';
            document.getElementById('actionsPanel').style.display = 'block';
            
            renderGame();
            addLog("–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –ü–µ—Ä–≤—ã–π —Ö–æ–¥ —É " + gameState.players[0].name, "system");
        }

        function renderGame() {
            renderSystems();
            renderPlayers();
            updateTurnIndicator();
        }

        function renderSystems() {
            const grid = document.getElementById('systemsGrid');
            grid.innerHTML = '';
            
            gameState.systems.forEach(system => {
                const systemDiv = document.createElement('div');
                systemDiv.className = `system ${system.owner ? 'owned player-' + system.owner : ''}`;
                systemDiv.dataset.id = system.id;
                
                let ownerInfo = '';
                if (system.owner) {
                    const player = gameState.players[system.owner - 1];
                    ownerInfo = `<div style="color:${player.color}">${player.icon} ${player.name}</div>`;
                }
                
                systemDiv.innerHTML = `
                    <div class="system-name">${system.name}</div>
                    ${ownerInfo}
                    <div class="system-resources">
                        <span><i class="fas fa-coins"></i> ${system.resources.credits}</span>
                        <span><i class="fas fa-fighter-jet"></i> ${system.resources.fleet}</span>
                        <span><i class="fas fa-flask"></i> ${system.resources.tech}</span>
                    </div>
                    ${system.owner ? `<div class="fleet" style="background:${gameState.players[system.owner-1].color}">${system.resources.fleet} –∫–æ—Ä–∞–±–ª–µ–π</div>` : ''}
                `;
                
                systemDiv.onclick = () => selectSystem(system.id);
                grid.appendChild(systemDiv);
            });
        }

        function renderPlayers() {
            const container = document.getElementById('playersContainer');
            container.innerHTML = '';
            
            gameState.players.forEach((player, index) => {
                const isActive = index === gameState.currentPlayer;
                const card = document.createElement('div');
                card.className = `player-card player-${player.id} ${isActive ? 'active' : ''}`;
                card.style.borderLeftColor = player.color;
                
                card.innerHTML = `
                    <div class="player-header">
                        <div class="player-name">${player.icon} ${player.name}</div>
                        <div>${isActive ? 'üìç –•–û–î–ò–¢' : ''}</div>
                    </div>
                    <div>–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º: ${player.systems.length}</div>
                    <div class="player-resources">
                        <div class="resource">
                            <i class="fas fa-coins" style="color:gold"></i>
                            <span>${player.resources.credits}</span>
                        </div>
                        <div class="resource">
                            <i class="fas fa-fighter-jet" style="color:silver"></i>
                            <span>${player.resources.fleet}</span>
                        </div>
                        <div class="resource">
                            <i class="fas fa-flask" style="color:#da77f2"></i>
                            <span>${player.resources.tech}</span>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function selectSystem(systemId) {
            if (gameState.selectedSystem === systemId) {
                gameState.selectedSystem = null;
            } else {
                gameState.selectedSystem = systemId;
            }
            
            // –í–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
            document.querySelectorAll('.system').forEach(sys => {
                sys.style.borderColor = sys.classList.contains('owned') ? 'currentColor' : 'transparent';
            });
            
            if (gameState.selectedSystem !== null) {
                const selectedSys = document.querySelector(`.system[data-id="${systemId}"]`);
                selectedSys.style.borderColor = 'white';
                selectedSys.style.boxShadow = '0 0 15px white';
                
                const system = gameState.systems[systemId];
                addLog(`–í—ã–±—Ä–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞: ${system.name}`, "system");
            }
            
            updateActionButtons();
        }

        function performAction(action) {
            const currentPlayer = gameState.players[gameState.currentPlayer];
            
            if (action === 'build') {
                if (gameState.selectedSystem === null) {
                    addLog("–í—ã–±–µ—Ä–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –ø–æ—Å—Ç—Ä–æ–π–∫–∏ —Ñ–ª–æ—Ç–∞", "error");
                    return;
                }
                
                const system = gameState.systems[gameState.selectedSystem];
                if (system.owner !== currentPlayer.id) {
                    addLog("–í—ã –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç–µ —ç—Ç—É —Å–∏—Å—Ç–µ–º—É!", "error");
                    return;
                }
                
                if (currentPlayer.resources.credits < 10) {
                    addLog("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤!", "error");
                    return;
                }
                
                currentPlayer.resources.credits -= 10;
                system.resources.fleet += 2;
                currentPlayer.resources.fleet += 2;
                
                addLog(`${currentPlayer.name} –ø–æ—Å—Ç—Ä–æ–∏–ª 2 –∫–æ—Ä–∞–±–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ ${system.name}`, currentPlayer.id);
                renderGame();
            }
            else if (action === 'attack') {
                if (gameState.selectedSystem === null) {
                    addLog("–í—ã–±–µ—Ä–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –∞—Ç–∞–∫–∏", "error");
                    return;
                }
                
                const targetSystem = gameState.systems[gameState.selectedSystem];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –∏–≥—Ä–æ–∫–∞ —Å–∏—Å—Ç–µ–º–∞, —Å–æ—Å–µ–¥–Ω—è—è —Å —Ü–µ–ª—å—é
                const playerSystems = currentPlayer.systems.map(id => gameState.systems[id]);
                const adjacentSystems = playerSystems.filter(sys => 
                    sys.connections.includes(targetSystem.id)
                );
                
                if (adjacentSystems.length === 0 && !currentPlayer.systems.includes(targetSystem.id)) {
                    addLog("–ù–µ—Ç —Å–æ—Å–µ–¥–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –∞—Ç–∞–∫–∏!", "error");
                    return;
                }
                
                if (targetSystem.owner === currentPlayer.id) {
                    addLog("–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ —É–∂–µ –≤–∞—à–∞!", "error");
                    return;
                }
                
                // –°–∏–º—É–ª—è—Ü–∏—è –±–æ—è
                const attackerFleet = adjacentSystems.reduce((sum, sys) => sum + sys.resources.fleet, 0);
                const defenderFleet = targetSystem.resources.fleet;
                
                if (attackerFleet <= defenderFleet) {
                    addLog("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ñ–ª–æ—Ç–∞ –¥–ª—è –∞—Ç–∞–∫–∏!", "error");
                    return;
                }
                
                // –ó–∞—Ö–≤–∞—Ç —Å–∏—Å—Ç–µ–º—ã
                if (targetSystem.owner) {
                    const oldOwner = gameState.players[targetSystem.owner - 1];
                    oldOwner.systems = oldOwner.systems.filter(id => id !== targetSystem.id);
                }
                
                targetSystem.owner = currentPlayer.id;
                currentPlayer.systems.push(targetSystem.id);
                targetSystem.resources.fleet = Math.floor(attackerFleet - defenderFleet);
                
                addLog(`${currentPlayer.name} –∑–∞—Ö–≤–∞—Ç–∏–ª —Å–∏—Å—Ç–µ–º—É ${targetSystem.name}!`, currentPlayer.id);
                renderGame();
                
                checkVictory();
            }
            else if (action === 'research') {
                if (currentPlayer.resources.credits < 15) {
                    addLog("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π!", "error");
                    return;
                }
                
                currentPlayer.resources.credits -= 15;
                currentPlayer.resources.tech += 5;
                
                addLog(`${currentPlayer.name} –ø—Ä–æ–≤–µ–ª –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è (+5 —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π)`, currentPlayer.id);
                renderGame();
            }
            
            updateActionButtons();
        }

        function endTurn() {
            const currentPlayer = gameState.players[gameState.currentPlayer];
            
            // –°–±–æ—Ä —Ä–µ—Å—É—Ä—Å–æ–≤
            currentPlayer.systems.forEach(systemId => {
                const system = gameState.systems[systemId];
                currentPlayer.resources.credits += system.resources.credits;
            });
            
            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–≥—Ä–æ–∫—É
            gameState.currentPlayer = (gameState.currentPlayer + 1) % gameState.players.length;
            
            // –ï—Å–ª–∏ –Ω–∞—á–∞–ª—Å—è –Ω–æ–≤—ã–π –∫—Ä—É–≥
            if (gameState.currentPlayer === 0) {
                gameState.round++;
                updateGamePhase();
                
                // –ö–∞–∂–¥—ã–µ 3 —Ä–∞—É–Ω–¥–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ñ–ª–æ—Ç
                if (gameState.round % 3 === 0) {
                    gameState.players.forEach(player => {
                        player.systems.forEach(systemId => {
                            gameState.systems[systemId].resources.fleet += 1;
                            player.resources.fleet += 1;
                        });
                    });
                    addLog("–í—Å–µ —Ñ–ª–æ—Ç—ã —É–≤–µ–ª–∏—á–µ–Ω—ã!", "system");
                }
            }
            
            gameState.selectedSystem = null;
            renderGame();
            updateTurnIndicator();
            addLog(`–•–æ–¥ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ ${gameState.players[gameState.currentPlayer].name}`, "system");
        }

        function updateGamePhase() {
            const phaseElement = document.getElementById('gamePhase');
            phaseElement.textContent = `–†–∞—É–Ω–¥ ${gameState.round} | –•–æ–¥: ${gameState.players[gameState.currentPlayer].name}`;
        }

        function updateTurnIndicator() {
            document.getElementById('currentPlayerTurn').textContent = 
                `–°–µ–π—á–∞—Å —Ö–æ–¥–∏—Ç: ${gameState.players[gameState.currentPlayer].name}`;
        }

        function updateActionButtons() {
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –∞–∫—Ç–∏–≤–∞—Ü–∏–∏/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫
        }

        function checkVictory() {
            const totalSystems = gameState.systems.length;
            
            for (let player of gameState.players) {
                if (player.systems.length > totalSystems * 0.6) { // 60% —Å–∏—Å—Ç–µ–º
                    showVictory(player);
                    return true;
                }
            }
            
            return false;
        }

        function showVictory(winner) {
            document.getElementById('winnerName').textContent = winner.name;
            document.getElementById('winnerName').style.color = winner.color;
            document.getElementById('victoryText').textContent = 
                `–ó–∞—Ö–≤–∞—á–µ–Ω–æ ${winner.systems.length} –∏–∑ ${gameState.systems.length} —Å–∏—Å—Ç–µ–º –≥–∞–ª–∞–∫—Ç–∏–∫–∏!`;
            document.getElementById('victoryScreen').style.display = 'flex';
            addLog(`–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê! ${winner.name} –ø–æ–±–µ–¥–∏–ª!`, "victory");
        }

        function addLog(message, type = "system") {
            const logEntries = document.getElementById('logEntries');
            const entry = document.createElement('div');
            
            let className = 'log-entry';
            if (type === 'error') {
                className += ' player-2';
            } else if (type === 'victory') {
                className += ' player-3';
            } else if (typeof type === 'number') {
                className += ` player-${type}`;
            }
            
            entry.className = className;
            entry.innerHTML = `<i class="fas fa-circle" style="font-size: 8px; margin-right: 10px;"></i> ${message}`;
            
            logEntries.appendChild(entry);
            logEntries.scrollTop = logEntries.scrollHeight;
        }

        function clearLog() {
            document.getElementById('logEntries').innerHTML = 
                '<div class="log-entry player-1">–ñ—É—Ä–Ω–∞–ª –æ—á–∏—â–µ–Ω</div>';
        }

        function resetGame() {
            document.getElementById('victoryScreen').style.display = 'none';
            document.getElementById('gameBoard').style.display = 'none';
            document.getElementById('actionsPanel').style.display = 'none';
            document.getElementById('gameSetup').style.display = 'block';
            clearLog();
            addLog("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Galaxy Conquest!", "system");
        }

        // –û–Ω–ª–∞–π–Ω-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        function initFirebase() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
            addLog("–û–Ω–ª–∞–π–Ω-—Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω", "system");
        }

        function joinOnlineRoom() {
            const roomCode = document.getElementById('roomCode').value || 
                            'ROOM-' + Math.random().toString(36).substr(2, 5).toUpperCase();
            
            gameState.onlineRoom = roomCode;
            document.getElementById('connectionStatus').className = 'connection-status connected';
            document.getElementById('connectionStatus').textContent = `–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –∫–æ–º–Ω–∞—Ç–µ: ${roomCode}`;
            document.getElementById('startBtn').disabled = false;
            
            addLog(`–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –∫–æ–º–Ω–∞—Ç–µ: ${roomCode}`, "system");
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('gameMode').addEventListener('change', function() {
                initGame();
            });
            
            initGame();
            addLog("–ò–≥—Ä–∞ –≥–æ—Ç–æ–≤–∞! –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –Ω–∞—á–Ω–∏—Ç–µ –∏–≥—Ä—É.", "system");
        });
    </script>
</body>
</html>